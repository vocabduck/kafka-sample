import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;
import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.s3.S3Client;
import software.amazon.awssdk.services.s3.model.PutObjectRequest;

import java.io.File;
import java.nio.file.Paths;

public class S3Exporter {

    private final S3Client s3;

    public S3Exporter(String accessKey, String secretKey, String region, String endpoint) {
        this.s3 = S3Client.builder()
                .region(Region.of(region))
                .credentialsProvider(StaticCredentialsProvider.create(
                        AwsBasicCredentials.create(accessKey, secretKey)))
                .endpointOverride(URI.create(endpoint)) // use only if custom endpoint is provided
                .build();
    }

    public void uploadFile(String bucket, String key, File file) {
        PutObjectRequest putReq = PutObjectRequest.builder()
                .bucket(bucket)
                .key(key)
                .build();

        s3.putObject(putReq, Paths.get(file.getAbsolutePath()));
    }
}

public static void main(String[] args) {
    String accessKey = System.getenv("S3_ACCESS_KEY");
    String secretKey = System.getenv("S3_SECRET_KEY");
    String region = "ap-south-1";
    String endpoint = "https://s3.ap-south-1.amazonaws.com"; // Replace if overridden

    S3Exporter exporter = new S3Exporter(accessKey, secretKey, region, endpoint);

    // Example values (simulate #jsonPath substitution logic)
    String date = "2025-07-02";
    String inputFileName = "my_file.xml";

    String key = "BaNCS/" + date + "/" + inputFileName;

    File file = new File("/mount/path/data/in/BaNCS/" + date + "/" + inputFileName);
    exporter.uploadFile("ictdev", key, file);
}
